<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GTM Testing Lab</title>
    <!-- Google Tag Manager -->
    <script>(function (w, d, s, l, i) {
            w[l] = w[l] || []; w[l].push({
                'gtm.start':
                    new Date().getTime(), event: 'gtm.js'
            }); var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
                    'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-5KSHHG44');</script>
    <!-- End Google Tag Manager -->

    <script>(function (w, d, s, l, i) {
            w[l] = w[l] || []; w[l].push({
                'gtm.start':
                    new Date().getTime(), event: 'gtm.js'
            }); var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
                    'https://your-sgtm-domain.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-WRZ2ZGWL');</script>


    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: #4CAF50;
            color: white;
            padding: 20px 0;
            text-align: center;
        }

        .setup-section {
            background-color: #fff;
            border-radius: 5px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .product-card {
            background-color: #fff;
            border-radius: 5px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }

        .product-card:hover {
            transform: translateY(-5px);
        }

        .product-image {
            height: 150px;
            background-color: #eee;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: #777;
        }

        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px 0;
            font-size: 14px;
        }

        button:hover {
            background-color: #45a049;
        }

        textarea {
            width: 100%;
            height: 150px;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .cart-section {
            background-color: #fff;
            border-radius: 5px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .cart-items {
            margin-top: 15px;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .events-log {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            padding: 10px;
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 14px;
        }

        .tab-container {
            margin-top: 20px;
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #f1f1f1;
            margin-right: 2px;
        }

        .tab.active {
            background-color: #fff;
            border: 1px solid #ddd;
            border-bottom: none;
        }

        .tab-content {
            display: none;
            padding: 20px;
            background-color: #fff;
            border: 1px solid #ddd;
            border-top: none;
        }

        .tab-content.active {
            display: block;
        }

        #snackbar {
            visibility: hidden;
            min-width: 250px;
            margin-left: -125px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 2px;
            padding: 16px;
            position: fixed;
            z-index: 1;
            left: 50%;
            bottom: 30px;
        }

        #snackbar.show {
            visibility: visible;
            animation: fadein 0.5s, fadeout 0.5s 2.5s;
        }

        @keyframes fadein {
            from {
                bottom: 0;
                opacity: 0;
            }

            to {
                bottom: 30px;
                opacity: 1;
            }
        }

        @keyframes fadeout {
            from {
                bottom: 30px;
                opacity: 1;
            }

            to {
                bottom: 0;
                opacity: 0;
            }
        }
    </style>
</head>

<body>
    <!-- GTM Container Injection Point (this will be replaced by code from textarea) -->

    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5KSHHG44" height="0" width="0"
            style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <header>
        <div class="container">
            <h1>GTM Testing Lab</h1>
            <p>A playground for testing Google Tag Manager implementations</p>
        </div>
    </header>

    <div class="container">


        <div class="setup-section">
            <h2>DataLayer Inspector</h2>
            <div id="dataLayer-content">
                <p>DataLayer is not initialized yet. Inject GTM to initialize.</p>
            </div>
            <button onclick="refreshDataLayer()">Refresh DataLayer View</button>
        </div>

        <div class="setup-section">
            <h2>Event Triggers</h2>
            <div class="button-group">
                <button onclick="pushEvent('view_item_list')">Trigger view_item_list</button>
                <button onclick="pushEvent('select_item')">Trigger select_item</button>
                <button onclick="pushEvent('view_item')">Trigger view_item</button>
                <button onclick="pushEvent('view_promotion')">Trigger view_promotion</button>
                <button onclick="pushEvent('select_promotion')">Trigger select_promotion</button>
            </div>
            <div class="button-group">
                <button onclick="pushEvent('login')">Trigger login</button>
                <button onclick="pushEvent('sign_up')">Trigger sign_up</button>
                <button onclick="pushEvent('view_search_results')">Trigger view_search_results</button>
                <button onclick="pushEvent('share')">Trigger share</button>
            </div>
            <div class="button-group">
                <button onclick="pushUserProperties()">Set User Properties</button>
                <button onclick="pushPageView()">Trigger Page View</button>
                <button onclick="clearDataLayer()">Clear DataLayer</button>
            </div>
        </div>

        <h2>E-commerce Demo</h2>
        <div class="products-grid">
            <!-- Product 1 -->
            <div class="product-card" id="product-1" data-product-id="P12345" data-product-name="Premium T-Shirt"
                data-product-price="29.99" data-product-category="Apparel">
                <div class="product-image">Product Image: Premium T-Shirt</div>
                <h3>Premium T-Shirt</h3>
                <p>$29.99</p>
                <p>A comfortable cotton t-shirt for everyday wear.</p>
                <button onclick="viewProductDetails('P12345', 'Premium T-Shirt', 29.99, 'Apparel')">View
                    Details</button>
                <button onclick="addToCart('P12345', 'Premium T-Shirt', 29.99, 'Apparel', 1)">Add to Cart</button>
            </div>

            <!-- Product 2 -->
            <div class="product-card" id="product-2" data-product-id="P67890" data-product-name="Wireless Headphones"
                data-product-price="149.99" data-product-category="Electronics">
                <div class="product-image">Product Image: Wireless Headphones</div>
                <h3>Wireless Headphones</h3>
                <p>$149.99</p>
                <p>High-quality wireless headphones with noise cancellation.</p>
                <button onclick="viewProductDetails('P67890', 'Wireless Headphones', 149.99, 'Electronics')">View
                    Details</button>
                <button onclick="addToCart('P67890', 'Wireless Headphones', 149.99, 'Electronics', 1)">Add to
                    Cart</button>
            </div>

            <!-- Product 3 -->
            <div class="product-card" id="product-3" data-product-id="P24680" data-product-name="Leather Wallet"
                data-product-price="49.99" data-product-category="Accessories">
                <div class="product-image">Product Image: Leather Wallet</div>
                <h3>Leather Wallet</h3>
                <p>$49.99</p>
                <p>Genuine leather wallet with multiple compartments.</p>
                <button onclick="viewProductDetails('P24680', 'Leather Wallet', 49.99, 'Accessories')">View
                    Details</button>
                <button onclick="addToCart('P24680', 'Leather Wallet', 49.99, 'Accessories', 1)">Add to Cart</button>
            </div>

            <!-- Product 4 -->
            <div class="product-card" id="product-4" data-product-id="P13579" data-product-name="Smart Watch"
                data-product-price="199.99" data-product-category="Electronics">
                <div class="product-image">Product Image: Smart Watch</div>
                <h3>Smart Watch</h3>
                <p>$199.99</p>
                <p>Feature-rich smartwatch with fitness tracking.</p>
                <button onclick="viewProductDetails('P13579', 'Smart Watch', 199.99, 'Electronics')">View
                    Details</button>
                <button onclick="addToCart('P13579', 'Smart Watch', 199.99, 'Electronics', 1)">Add to Cart</button>
            </div>
        </div>

        <div class="cart-section">
            <h2>Shopping Cart</h2>
            <div id="cart-items" class="cart-items">
                <p>Your cart is empty.</p>
            </div>
            <div class="button-group">
                <button onclick="beginCheckout()">Proceed to Checkout</button>
                <button onclick="addShippingInfo()">Add Shipping Info</button>
                <button onclick="addPaymentInfo()">Add Payment Info</button>
                <button onclick="purchase()">Complete Purchase</button>
                <button onclick="clearCart()">Clear Cart</button>
            </div>
        </div>

        <div class="setup-section">
            <h2>Events Log</h2>
            <div id="events-log" class="events-log">
                <p>Events will appear here when triggered.</p>
            </div>
            <button onclick="clearEventsLog()">Clear Log</button>
        </div>
    </div>

    <div id="snackbar">Event triggered!</div>

    <script>
        // Initialize variables
        let cart = [];
        let eventLog = [];

        // Check if dataLayer exists, if not create it
        window.dataLayer = window.dataLayer || [];

        // Function to inject GTM code
        function injectGTM(type) {
            let codeElement = type === 'web' ? document.getElementById('gtm-code') : document.getElementById('server-gtm-code');
            let code = codeElement.value;

            if (code.trim() === '') {
                showSnackbar('Please paste GTM code first');
                return;
            }

            // Clear previous GTM injections
            document.getElementById('gtm-injection-placeholder').innerHTML = '';

            // Create a new div and insert the GTM code
            let gtmDiv = document.createElement('div');
            gtmDiv.innerHTML = code;
            document.getElementById('gtm-injection-placeholder').appendChild(gtmDiv);

            logEvent(`${type === 'web' ? 'Web' : 'Server-side'} GTM code injected`);
            showSnackbar(`${type === 'web' ? 'Web' : 'Server-side'} GTM injected successfully`);
            refreshDataLayer();
        }

        // Function to push events to dataLayer
        function pushEvent(eventName) {
            let eventData = {};

            switch (eventName) {
                case 'view_item_list':
                    eventData = {
                        event: 'view_item_list',
                        ecommerce: {
                            items: [
                                {
                                    item_id: 'P12345',
                                    item_name: 'Premium T-Shirt',
                                    price: 29.99,
                                    item_category: 'Apparel',
                                    index: 0
                                },
                                {
                                    item_id: 'P67890',
                                    item_name: 'Wireless Headphones',
                                    price: 149.99,
                                    item_category: 'Electronics',
                                    index: 1
                                },
                                {
                                    item_id: 'P24680',
                                    item_name: 'Leather Wallet',
                                    price: 49.99,
                                    item_category: 'Accessories',
                                    index: 2
                                },
                                {
                                    item_id: 'P13579',
                                    item_name: 'Smart Watch',
                                    price: 199.99,
                                    item_category: 'Electronics',
                                    index: 3
                                }
                            ]
                        }
                    };
                    break;

                case 'select_item':
                    eventData = {
                        event: 'select_item',
                        ecommerce: {
                            items: [
                                {
                                    item_id: 'P12345',
                                    item_name: 'Premium T-Shirt',
                                    price: 29.99,
                                    item_category: 'Apparel',
                                    index: 0
                                }
                            ]
                        }
                    };
                    break;

                case 'view_item':
                    eventData = {
                        event: 'view_item',
                        ecommerce: {
                            currency: 'USD',
                            value: 29.99,
                            items: [
                                {
                                    item_id: 'P12345',
                                    item_name: 'Premium T-Shirt',
                                    price: 29.99,
                                    item_category: 'Apparel',
                                    quantity: 1
                                }
                            ]
                        }
                    };
                    break;

                case 'view_promotion':
                    eventData = {
                        event: 'view_promotion',
                        ecommerce: {
                            promotions: [
                                {
                                    promotion_id: 'SUMMER_SALE',
                                    promotion_name: 'Summer Sale',
                                    creative_name: 'summer_banner',
                                    creative_slot: 'homepage_top',
                                    location_id: 'hero_banner'
                                }
                            ]
                        }
                    };
                    break;

                case 'select_promotion':
                    eventData = {
                        event: 'select_promotion',
                        ecommerce: {
                            promotions: [
                                {
                                    promotion_id: 'SUMMER_SALE',
                                    promotion_name: 'Summer Sale',
                                    creative_name: 'summer_banner',
                                    creative_slot: 'homepage_top',
                                    location_id: 'hero_banner'
                                }
                            ]
                        }
                    };
                    break;

                case 'login':
                    eventData = {
                        event: 'login',
                        method: 'Email'
                    };
                    break;

                case 'sign_up':
                    eventData = {
                        event: 'sign_up',
                        method: 'Email'
                    };
                    break;

                case 'view_search_results':
                    eventData = {
                        event: 'view_search_results',
                        search_term: 'tshirt'
                    };
                    break;

                case 'share':
                    eventData = {
                        event: 'share',
                        method: 'Twitter',
                        content_type: 'Product',
                        item_id: 'P12345'
                    };
                    break;

                default:
                    eventData = {
                        event: eventName
                    };
            }

            // Clear ecommerce object before pushing new ecommerce event
            if (eventData.ecommerce) {
                window.dataLayer.push({ ecommerce: null });
            }

            window.dataLayer.push(eventData);
            logEvent(`Event pushed: ${eventName}`);
            showSnackbar(`Event triggered: ${eventName}`);
            refreshDataLayer();
        }

        // User properties
        function pushUserProperties() {
            window.dataLayer.push({
                event: 'user_data',
                user_id: 'U12345',
                user_properties: {
                    logged_in: true,
                    account_type: 'premium',
                    lifetime_value: 245.5,
                    registration_date: '2023-01-15'
                }
            });
            logEvent('User properties set');
            showSnackbar('User properties set');
            refreshDataLayer();
        }

        // Page view
        function pushPageView() {
            window.dataLayer.push({
                event: 'page_view',
                page: {
                    title: 'GTM Testing Lab',
                    location: window.location.href,
                    path: window.location.pathname
                }
            });
            logEvent('Page view triggered');
            showSnackbar('Page view triggered');
            refreshDataLayer();
        }

        // View product details
        function viewProductDetails(productId, productName, price, category) {
            window.dataLayer.push({ ecommerce: null });
            window.dataLayer.push({
                event: 'view_item',
                ecommerce: {
                    currency: 'USD',
                    value: price,
                    items: [{
                        item_id: productId,
                        item_name: productName,
                        price: price,
                        item_category: category,
                        quantity: 1
                    }]
                }
            });
            logEvent(`View product: ${productName}`);
            showSnackbar(`Viewing details: ${productName}`);
            refreshDataLayer();
        }

        // Add to cart
        function addToCart(productId, productName, price, category, quantity) {
            // Check if product is already in cart
            let existingProduct = cart.find(item => item.item_id === productId);

            if (existingProduct) {
                existingProduct.quantity += quantity;
            } else {
                cart.push({
                    item_id: productId,
                    item_name: productName,
                    price: price,
                    item_category: category,
                    quantity: quantity
                });
            }

            window.dataLayer.push({ ecommerce: null });
            window.dataLayer.push({
                event: 'add_to_cart',
                ecommerce: {
                    currency: 'USD',
                    value: price * quantity,
                    items: [{
                        item_id: productId,
                        item_name: productName,
                        price: price,
                        item_category: category,
                        quantity: quantity
                    }]
                }
            });

            updateCartDisplay();
            logEvent(`Added to cart: ${productName}`);
            showSnackbar(`Added to cart: ${productName}`);
            refreshDataLayer();
        }

        // Begin checkout
        function beginCheckout() {
            if (cart.length === 0) {
                showSnackbar('Your cart is empty');
                return;
            }

            let totalValue = cart.reduce((total, item) => total + (item.price * item.quantity), 0);

            window.dataLayer.push({ ecommerce: null });
            window.dataLayer.push({
                event: 'begin_checkout',
                ecommerce: {
                    currency: 'USD',
                    value: totalValue,
                    items: cart
                }
            });

            logEvent('Begin checkout');
            showSnackbar('Beginning checkout process');
            refreshDataLayer();
        }

        // Add shipping info
        function addShippingInfo() {
            if (cart.length === 0) {
                showSnackbar('Your cart is empty');
                return;
            }

            let totalValue = cart.reduce((total, item) => total + (item.price * item.quantity), 0);

            window.dataLayer.push({ ecommerce: null });
            window.dataLayer.push({
                event: 'add_shipping_info',
                ecommerce: {
                    currency: 'USD',
                    value: totalValue,
                    shipping_tier: 'Ground',
                    items: cart
                }
            });

            logEvent('Added shipping info');
            showSnackbar('Shipping information added');
            refreshDataLayer();
        }

        // Add payment info
        function addPaymentInfo() {
            if (cart.length === 0) {
                showSnackbar('Your cart is empty');
                return;
            }

            let totalValue = cart.reduce((total, item) => total + (item.price * item.quantity), 0);

            window.dataLayer.push({ ecommerce: null });
            window.dataLayer.push({
                event: 'add_payment_info',
                ecommerce: {
                    currency: 'USD',
                    value: totalValue,
                    payment_type: 'Credit Card',
                    items: cart
                }
            });

            logEvent('Added payment info');
            showSnackbar('Payment information added');
            refreshDataLayer();
        }

        // Complete purchase
        function purchase() {
            if (cart.length === 0) {
                showSnackbar('Your cart is empty');
                return;
            }

            let totalValue = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
            let transactionId = 'T-' + Math.floor(Math.random() * 100000);

            window.dataLayer.push({ ecommerce: null });
            window.dataLayer.push({
                event: 'purchase',
                ecommerce: {
                    transaction_id: transactionId,
                    value: totalValue,
                    tax: totalValue * 0.08,
                    shipping: 5.99,
                    currency: 'USD',
                    coupon: 'SUMMER20',
                    items: cart
                }
            });

            logEvent(`Purchase completed: ${transactionId}`);
            showSnackbar('Purchase completed!');
            clearCart();
            refreshDataLayer();
        }

        // Clear cart
        function clearCart() {
            cart = [];
            updateCartDisplay();
            logEvent('Cart cleared');
            showSnackbar('Cart cleared');
        }

        // Update cart display
        function updateCartDisplay() {
            let cartElement = document.getElementById('cart-items');

            if (cart.length === 0) {
                cartElement.innerHTML = '<p>Your cart is empty.</p>';
                return;
            }

            let totalValue = 0;
            let cartHtml = '';

            cart.forEach(item => {
                let itemTotal = item.price * item.quantity;
                totalValue += itemTotal;
                cartHtml += `
                    <div class="cart-item">
                        <div>
                            <strong>${item.item_name}</strong> x ${item.quantity}
                        </div>
                        <div>$${itemTotal.toFixed(2)}</div>
                    </div>
                `;
            });

            cartHtml += `
                <div class="cart-item">
                    <div><strong>Total:</strong></div>
                    <div><strong>$${totalValue.toFixed(2)}</strong></div>
                </div>
            `;

            cartElement.innerHTML = cartHtml;
        }

        // Tab functionality
        function openTab(evt, tabName) {
            let tabcontent = document.getElementsByClassName("tab-content");
            for (let i = 0; i < tabcontent.length; i++) {
                tabcontent[i].classList.remove("active");
            }

            let tablinks = document.getElementsByClassName("tab");
            for (let i = 0; i < tablinks.length; i++) {
                tablinks[i].classList.remove("active");
            }

            document.getElementById(tabName).classList.add("active");
            evt.currentTarget.classList.add("active");
        }

        // Refresh DataLayer view
        function refreshDataLayer() {
            let dlElement = document.getElementById('dataLayer-content');

            if (!window.dataLayer) {
                dlElement.innerHTML = '<p>DataLayer is not initialized yet.</p>';
                return;
            }

            let dlHtml = '<pre>' + JSON.stringify(window.dataLayer, null, 2) + '</pre>';
            dlElement.innerHTML = dlHtml;
        }

        // Clear DataLayer
        function clearDataLayer() {
            window.dataLayer = [];
            refreshDataLayer();
            logEvent('DataLayer cleared');
            showSnackbar('DataLayer cleared');
        }

        // Log events
        function logEvent(eventDesc) {
            let now = new Date();
            let timestamp = now.toLocaleTimeString();
            eventLog.push(`[${timestamp}] ${eventDesc}`);

            let logElement = document.getElementById('events-log');
            let logHtml = '';

            // Show most recent events first
            for (let i = eventLog.length - 1; i >= 0; i--) {
                logHtml += `<div>${eventLog[i]}</div>`;
            }

            logElement.innerHTML = logHtml;
        }

        // Clear events log
        function clearEventsLog() {
            eventLog = [];
            document.getElementById('events-log').innerHTML = '<p>Events will appear here when triggered.</p>';
            showSnackbar('Events log cleared');
        }

        // Show snackbar notification
        function showSnackbar(message) {
            let snackbar = document.getElementById("snackbar");
            snackbar.textContent = message;
            snackbar.className = "show";
            setTimeout(function () { snackbar.className = snackbar.className.replace("show", ""); }, 3000);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function () {
            refreshDataLayer();
        });
    </script>
</body>

</html>
